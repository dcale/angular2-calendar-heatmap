"use strict"
var __decorate=this&&this.__decorate||function(t,e,n,i){var a,o=arguments.length,r=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i
if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,e,n,i)
else for(var s=t.length-1;s>=0;s--)(a=t[s])&&(r=(o<3?a(r):o>3?a(e,n,r):a(e,n))||r)
return o>3&&r&&Object.defineProperty(e,n,r),r},__metadata=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)}
Object.defineProperty(exports,"__esModule",{value:!0})
var core_1=require("@angular/core"),CalendarHeatmap=function(){function t(){this.color="#ff4500",this.overview="global",this.handler=new core_1.EventEmitter,this.gutter=5,this.item_gutter=1,this.width=1e3,this.height=200,this.item_size=10,this.label_padding=40,this.max_block_height=20,this.transition_duration=500,this.in_transition=!1,this.tooltip_width=250,this.tooltip_padding=15,this.history=["global"],this.selected={}}return t.prototype.ngOnChanges=function(){this.data&&(this.updateDataSummary(),this.drawChart())},t.prototype.ngAfterViewInit=function(){var t=this.element.nativeElement
this.svg=d3.select(t).append("svg").attr("class","svg"),this.items=this.svg.append("g"),this.labels=this.svg.append("g"),this.buttons=this.svg.append("g"),this.tooltip=d3.select(t).append("div").attr("class","heatmap-tooltip").style("opacity",0),this.calculateDimensions(),this.drawChart()},t.prototype.getNumberOfWeeks=function(){var t=Math.round((moment()-moment().subtract(1,"year").startOf("week"))/864e5)
return Math.trunc(t/7)+1},t.prototype.calculateDimensions=function(){var t=this.element.nativeElement
this.width=t.clientWidth<1e3?1e3:t.clientWidth,this.item_size=(this.width-this.label_padding)/this.getNumberOfWeeks()-this.gutter,this.height=this.label_padding+7*(this.item_size+this.gutter),this.svg.attr({width:this.width,height:this.height})},t.prototype.onResize=function(t){this.calculateDimensions(),this.data&&this.data[0].summary&&this.drawChart()},t.prototype.updateDataSummary=function(){this.data[0].summary||this.data.map(function(t){var e=t.details.reduce(function(t,e){return t[e.name]?t[e.name].value+=e.value:t[e.name]={value:e.value},t},{}),n=Object.keys(e).map(function(t){return{name:t,value:e[t].value}})
return t.summary=n.sort(function(t,e){return e.value-t.value}),t})},t.prototype.drawChart=function(){this.svg&&this.data&&("global"===this.overview?this.drawGlobalOverview():"year"===this.overview?this.drawYearOverview():"month"===this.overview?this.drawMonthOverview():"week"===this.overview?this.drawWeekOverview():"day"===this.overview&&this.drawDayOverview())},t.prototype.drawGlobalOverview=function(){var t=this
this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview)
var e=moment(this.data[0].date).startOf("year"),n=moment(this.data[this.data.length-1].date).endOf("year"),i=this.data,a=d3.time.years(e,n).map(function(t){var e=moment(t)
return{date:e,total:i.reduce(function(t,n){return moment(n.date).year()===e.year()&&(t+=n.total),t},0),summary:function(){var t=i.reduce(function(t,n){if(moment(n.date).year()===e.year())for(var i=0;i<n.summary.length;i++)t[n.summary[i].name]?t[n.summary[i].name].value+=n.summary[i].value:t[n.summary[i].name]={value:n.summary[i].value}
return t},{})
return Object.keys(t).map(function(e){return{name:e,value:t[e].value}}).sort(function(t,e){return e.value-t.value})}()}}),o=d3.max(a,function(t){return t.total}),r=d3.time.years(e,n).map(function(t){return moment(t)}),s=d3.scale.ordinal().rangeRoundBands([0,this.width],.05).domain(r.map(function(t){return t.year()}))
this.items.selectAll(".item-block-year").remove()
this.items.selectAll(".item-block-year").data(a).enter().append("rect").attr("class","item item-block-year").attr("width",function(){return(t.width-t.label_padding)/r.length-5*t.gutter}).attr("height",function(){return t.height-t.label_padding}).attr("transform",function(e){return"translate("+s(e.date.year())+","+2*t.tooltip_padding+")"}).attr("fill",function(e){return d3.scale.linear().range(["#ffffff",t.color||"#ff4500"]).domain([-.15*o,o])(e.total)||"#ff4500"}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n=""
n+='<div class="header"><strong>'+(e.total?t.formatTime(e.total):"No time")+" tracked</strong></div>",n+="<div>in "+e.date.year()+"</div><br>"
for(var i=0;i<e.summary.length;i++)n+="<div><span><strong>"+e.summary[i].name+"</strong></span>",n+="<span>"+t.formatTime(e.summary[i].value)+"</span></div>"
for(var a=s(e.date.year())+t.tooltip_padding;t.width-a<t.tooltip_width+3*t.tooltip_padding;)a-=10
var o=3*t.tooltip_padding
t.tooltip.html(n).style("left",a+"px").style("top",o+"px").transition().duration(t.transition_duration/2).ease("ease-in").style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(e,n){return t.transition_duration*(n+1)/10}).duration(function(){return t.transition_duration}).ease("ease-in").style("opacity",1).call(function(t,e){t.empty()&&e()
var n=0
t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1})
this.labels.selectAll(".label-year").remove(),this.labels.selectAll(".label-year").data(r).enter().append("text").attr("class","label label-year").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return t.year()}).attr("x",function(t){return s(t.year())}).attr("y",this.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).year()===e.year()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-year").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}).on("click",function(e){t.in_transition||(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeGlobalOverview(),t.overview="year",t.drawChart())})},t.prototype.drawYearOverview=function(){var t=this
this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview)
var e=moment(this.selected.date).startOf("year"),n=moment(this.selected.date).endOf("year"),i=this.data.filter(function(t){return e<=moment(t.date)&&moment(t.date)<n}),a=d3.max(i,function(t){return t.total}),o=d3.scale.linear().range(["#ffffff",this.color]).domain([-.15*a,a])
this.items.selectAll(".item-circle").remove(),this.items.selectAll(".item-circle").data(i).enter().append("rect").attr("class","item item-circle").style("opacity",0).attr("x",function(n){return t.calcItemX(n,e)+(t.item_size-t.calcItemSize(n,a))/2}).attr("y",function(e){return t.calcItemY(e)+(t.item_size-t.calcItemSize(e,a))/2}).attr("rx",function(e){return t.calcItemSize(e,a)}).attr("ry",function(e){return t.calcItemSize(e,a)}).attr("width",function(e){return t.calcItemSize(e,a)}).attr("height",function(e){return t.calcItemSize(e,a)}).attr("fill",function(t){return t.total>0?o(t.total):"transparent"}).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeYearOverview(),t.overview="day",t.drawChart())}).on("mouseover",function(n){if(!t.in_transition){var i=d3.select(d3.event.currentTarget),o=function(){i=i.transition().duration(t.transition_duration).ease("ease-in").attr("x",function(n){return t.calcItemX(n,e)-(1.1*t.item_size-t.item_size)/2}).attr("y",function(e){return t.calcItemY(e)-(1.1*t.item_size-t.item_size)/2}).attr("width",1.1*t.item_size).attr("height",1.1*t.item_size).transition().duration(t.transition_duration).ease("ease-in").attr("x",function(n){return t.calcItemX(n,e)+(t.item_size-t.calcItemSize(n,a))/2}).attr("y",function(e){return t.calcItemY(e)+(t.item_size-t.calcItemSize(e,a))/2}).attr("width",function(e){return t.calcItemSize(e,a)}).attr("height",function(e){return t.calcItemSize(e,a)}).each("end",o)}
o()
var r=""
r+='<div class="header"><strong>'+(n.total?t.formatTime(n.total):"No time")+" tracked</strong></div>",r+="<div>on "+moment(n.date).format("dddd, MMM Do YYYY")+"</div><br>",n.summary.map(function(e){r+="<div><span><strong>"+e.name+"</strong></span>",r+="<span>"+t.formatTime(e.value)+"</span></div>"})
var s=t.calcItemX(n,e)+t.item_size
t.width-s<t.tooltip_width+3*t.tooltip_padding&&(s-=t.tooltip_width+2*t.tooltip_padding)
var l=t.calcItemY(n)+t.item_size
t.tooltip.html(r).style("left",s+"px").style("top",l+"px").transition().duration(t.transition_duration/2).ease("ease-in").style("opacity",1)}}).on("mouseout",function(){t.in_transition||(d3.select(d3.event.currentTarget).transition().duration(t.transition_duration/2).ease("ease-in").attr("x",function(n){return t.calcItemX(n,e)+(t.item_size-t.calcItemSize(n,a))/2}).attr("y",function(e){return t.calcItemY(e)+(t.item_size-t.calcItemSize(e,a))/2}).attr("width",function(e){return t.calcItemSize(e,a)}).attr("height",function(e){return t.calcItemSize(e,a)}),t.hideTooltip())}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.transition_duration}).duration(function(){return t.transition_duration}).ease("ease-in").style("opacity",1).call(function(t,e){t.empty()&&e()
var n=0
t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1})
var r=d3.time.months(e,n),s=d3.scale.linear().range([0,this.width]).domain([0,r.length])
this.labels.selectAll(".label-month").remove(),this.labels.selectAll(".label-month").data(r).enter().append("text").attr("class","label label-month").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return t.toLocaleDateString("en-us",{month:"short"})}).attr("x",function(t,e){return s(e)+(s(e)-s(e-1))/2}).attr("y",this.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var n=moment(e)
t.items.selectAll(".item-circle").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).isSame(n,"month")?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.data.filter(function(t){return moment(e).startOf("month")<=moment(t.date)&&moment(t.date)<moment(e).endOf("month")}).length&&(t.selected={date:e},t.in_transition=!0,t.hideTooltip(),t.removeYearOverview(),t.overview="month",t.drawChart())}})
var l=d3.time.days(moment().startOf("week"),moment().endOf("week")),d=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.height]).domain(l.map(function(t){return moment(t).weekday()}))
this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(l).enter().append("text").attr("class","label label-day").attr("x",this.label_padding/3).attr("y",function(t,e){return d(e)+d.rangeBand()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return moment(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=moment(e)
t.items.selectAll(".item-circle").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-circle").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}),this.drawButton()},t.prototype.drawMonthOverview=function(){var t=this
this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview)
for(var e=moment(this.selected.date).startOf("month"),n=moment(this.selected.date).endOf("month"),i=this.data.filter(function(t){return e<=moment(t.date)&&moment(t.date)<n}),a=d3.max(i,function(t){return d3.max(t.summary,function(t){return t.value})}),o=d3.time.days(moment().startOf("week"),moment().endOf("week")),r=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.height]).domain(o.map(function(t){return moment(t).weekday()})),s=[e.clone()];e.week()!==n.week();)s.push(e.add(1,"week").clone())
var l=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.width],.05).domain(s.map(function(t){return t.week()}))
this.items.selectAll(".item-block-month").remove()
var d=this.items.selectAll(".item-block-month").data(i).enter().append("g").attr("class","item item-block-month").attr("width",function(){return(t.width-t.label_padding)/s.length-5*t.gutter}).attr("height",function(){return Math.min(r.rangeBand(),t.max_block_height)}).attr("transform",function(t){return"translate("+l(moment(t.date).week())+","+(r(moment(t.date).weekday())+r.rangeBand()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeMonthOverview(),t.overview="day",t.drawChart())}),c=(this.width-this.label_padding)/s.length-5*this.gutter,u=d3.scale.linear().rangeRound([0,c]),m=this.item_gutter
d.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(t){var e=parseInt(d3.select(this.parentNode).attr("total")),n=parseInt(d3.select(this.parentNode).attr("offset"))
return u.domain([0,e]),d3.select(this.parentNode).attr("offset",n+u(t.value)),n}).attr("width",function(t){var e=parseInt(d3.select(this.parentNode).attr("total"))
return u.domain([0,e]),Math.max(u(t.value)-m,1)}).attr("height",function(){return Math.min(r.rangeBand(),t.max_block_height)}).attr("fill",function(e){return d3.scale.linear().range(["#ffffff",t.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n=new Date(d3.select(d3.event.currentTarget.parentNode).attr("date")),i=""
i+='<div class="header"><strong>'+e.name+"</strong></div><br>",i+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",i+="<div>on "+moment(n).format("dddd, MMM Do YYYY")+"</div>"
for(var a=l(moment(n).week())+t.tooltip_padding;t.width-a<t.tooltip_width+3*t.tooltip_padding;)a-=10
var o=r(moment(n).weekday())+2*t.tooltip_padding
t.tooltip.html(i).style("left",a+"px").style("top",o+"px").transition().duration(t.transition_duration/2).ease("ease-in").style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.transition_duration}).duration(function(){return t.transition_duration}).ease("ease-in").style("opacity",1).call(function(t,e){t.empty()&&e()
var n=0
t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(s).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}).on("click",function(e){if(!t.in_transition){t.data.filter(function(t){return e.startOf("week")<=moment(t.date)&&moment(t.date)<e.endOf("week")}).length&&(t.in_transition=!0,t.selected={date:e},t.hideTooltip(),t.removeMonthOverview(),t.overview="week",t.drawChart())}}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(o).enter().append("text").attr("class","label label-day").attr("x",this.label_padding/3).attr("y",function(t,e){return r(e)+r.rangeBand()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return moment(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=moment(e)
t.items.selectAll(".item-block-month").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-month").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}),this.drawButton()},t.prototype.drawWeekOverview=function(){var t=this
this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview)
var e=moment(this.selected.date).startOf("week"),n=moment(this.selected.date).endOf("week"),i=this.data.filter(function(t){return e<=moment(t.date)&&moment(t.date)<n}),a=d3.max(i,function(t){return d3.max(t.summary,function(t){return t.value})}),o=d3.time.days(moment().startOf("week"),moment().endOf("week")),r=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.height]).domain(o.map(function(t){return moment(t).weekday()})),s=[e],l=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.width],.01).domain(s.map(function(t){return t.week()}))
this.items.selectAll(".item-block-week").remove()
var d=this.items.selectAll(".item-block-week").data(i).enter().append("g").attr("class","item item-block-week").attr("width",function(){return(t.width-t.label_padding)/s.length-5*t.gutter}).attr("height",function(){return Math.min(r.rangeBand(),t.max_block_height)}).attr("transform",function(t){return"translate("+l(moment(t.date).week())+","+(r(moment(t.date).weekday())+r.rangeBand()/1.75-15)+")"}).attr("total",function(t){return t.total}).attr("date",function(t){return t.date}).attr("offset",0).on("click",function(e){t.in_transition||0!==e.total&&(t.in_transition=!0,t.selected=e,t.hideTooltip(),t.removeWeekOverview(),t.overview="day",t.drawChart())}),c=(this.width-this.label_padding)/s.length-5*this.gutter,u=d3.scale.linear().rangeRound([0,c]),m=this.item_gutter
d.selectAll(".item-block-rect").data(function(t){return t.summary}).enter().append("rect").attr("class","item item-block-rect").attr("x",function(t){var e=parseInt(d3.select(this.parentNode).attr("total")),n=parseInt(d3.select(this.parentNode).attr("offset"))
return u.domain([0,e]),d3.select(this.parentNode).attr("offset",n+u(t.value)),n}).attr("width",function(t){var e=parseInt(d3.select(this.parentNode).attr("total"))
return u.domain([0,e]),Math.max(u(t.value)-m,1)}).attr("height",function(){return Math.min(r.rangeBand(),t.max_block_height)}).attr("fill",function(e){return d3.scale.linear().range(["#ffffff",t.color]).domain([-.15*a,a])(e.value)||"#ff4500"}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var n=new Date(d3.select(d3.event.currentTarget.parentNode).attr("date")),i=""
i+='<div class="header"><strong>'+e.name+"</strong></div><br>",i+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",i+="<div>on "+moment(n).format("dddd, MMM Do YYYY")+"</div>"
var a=parseInt(d3.select(d3.event.currentTarget.parentNode).attr("total"))
u.domain([0,a])
for(var o=parseInt(d3.select(d3.event.currentTarget).attr("x"))+u(e.value)/4+t.tooltip_width/4;t.width-o<t.tooltip_width+3*t.tooltip_padding;)o-=10
var s=r(moment(n).weekday())+1.5*t.tooltip_padding
t.tooltip.html(i).style("left",o+"px").style("top",s+"px").transition().duration(t.transition_duration/2).ease("ease-in").style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.transition_duration}).duration(function(){return t.transition_duration}).ease("ease-in").style("opacity",1).call(function(t,e){t.empty()&&e()
var n=0
t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1}),this.labels.selectAll(".label-week").remove(),this.labels.selectAll(".label-week").data(s).enter().append("text").attr("class","label label-week").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return"Week "+t.week()}).attr("x",function(t){return l(t.week())}).attr("y",this.label_padding/2).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).week()===e.week()?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-day").data(o).enter().append("text").attr("class","label label-day").attr("x",this.label_padding/3).attr("y",function(t,e){return r(e)+r.rangeBand()/1.75}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return moment(t).format("dddd")[0]}).on("mouseenter",function(e){if(!t.in_transition){var n=moment(e)
t.items.selectAll(".item-block-week").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return moment(t.date).day()===n.day()?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block-week").transition().duration(t.transition_duration).ease("ease-in").style("opacity",1)}),this.drawButton()},t.prototype.drawDayOverview=function(){var t=this
this.history[this.history.length-1]!==this.overview&&this.history.push(this.overview),Object.keys(this.selected).length||(this.selected=this.data[this.data.length-1])
var e=this.selected.summary.map(function(t){return t.name}),n=d3.scale.ordinal().rangeRoundBands([this.label_padding,this.height]).domain(e),i=d3.time.scale().range([2*this.label_padding,this.width]).domain([moment(this.selected.date).startOf("day"),moment(this.selected.date).endOf("day")])
this.items.selectAll(".item-block").remove(),this.items.selectAll(".item-block").data(this.selected.details).enter().append("rect").attr("class","item item-block").attr("x",function(t){return i(moment(t.date))}).attr("y",function(t){return n(t.name)+n.rangeBand()/2-15}).attr("width",function(t){var e=i(d3.time.second.offset(moment(t.date),t.value))
return Math.max(e-i(moment(t.date)),1)}).attr("height",function(){return Math.min(n.rangeBand(),t.max_block_height)}).attr("fill",function(){return t.color}).style("opacity",0).on("mouseover",function(e){if(!t.in_transition){var a=""
a+='<div class="header"><strong>'+e.name+"</strong><div><br>",a+="<div><strong>"+(e.value?t.formatTime(e.value):"No time")+" tracked</strong></div>",a+="<div>on "+moment(e.date).format("dddd, MMM Do YYYY HH:mm")+"</div>"
for(var o=100*e.value/86400+i(moment(e.date));t.width-o<t.tooltip_width+3*t.tooltip_padding;)o-=10
var r=n(e.name)+n.rangeBand()/2+t.tooltip_padding/2
t.tooltip.html(a).style("left",o+"px").style("top",r+"px").transition().duration(t.transition_duration/2).ease("ease-in").style("opacity",1)}}).on("mouseout",function(){t.in_transition||t.hideTooltip()}).on("click",function(e){t.handler&&t.handler.emit(e)}).transition().delay(function(){return(Math.cos(Math.PI*Math.random())+1)*t.transition_duration}).duration(function(){return t.transition_duration}).ease("ease-in").style("opacity",.5).call(function(t,e){t.empty()&&e()
var n=0
t.each(function(){++n}).each("end",function(){--n||e.apply(this,arguments)})},function(){t.in_transition=!1})
var a=d3.time.hours(moment(this.selected.date).startOf("day"),moment(this.selected.date).endOf("day")),o=d3.time.scale().range([2*this.label_padding,this.width]).domain([0,a.length])
this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-time").data(a).enter().append("text").attr("class","label label-time").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return moment(t).format("HH:mm")}).attr("x",function(t,e){return o(e)}).attr("y",this.label_padding/2).on("mouseenter",function(e){if(!t.in_transition){var n=i(moment(e))
t.items.selectAll(".item-block").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){var e=i(moment(t.date)),a=i(moment(t.date).add(t.value,"seconds"))
return n>=e&&n<=a?1:.1})}}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.transition_duration).ease("ease-in").style("opacity",.5)})
var r=this.label_padding
this.labels.selectAll(".label-project").remove(),this.labels.selectAll(".label-project").data(e).enter().append("text").attr("class","label label-project").attr("x",this.gutter).attr("y",function(t){return n(t)+n.rangeBand()/2}).attr("min-height",function(){return n.rangeBand()}).style("text-anchor","left").attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).text(function(t){return t}).each(function(t,e){for(var n=d3.select(this),i=n.node().getComputedTextLength(),a=n.text();i>1.5*r&&a.length>0;)a=a.slice(0,-1),n.text(a+"..."),i=n.node().getComputedTextLength()}).on("mouseenter",function(e){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.transition_duration).ease("ease-in").style("opacity",function(t){return t.name===e?1:.1})}).on("mouseout",function(){t.in_transition||t.items.selectAll(".item-block").transition().duration(t.transition_duration).ease("ease-in").style("opacity",.5)}),this.drawButton()},t.prototype.calcItemX=function(t,e){var n=moment(t.date),i=Math.round((n-moment(e).startOf("week"))/864e5)
return Math.trunc(i/7)*(this.item_size+this.gutter)+this.label_padding},t.prototype.calcItemY=function(t){return this.label_padding+moment(t.date).weekday()*(this.item_size+this.gutter)},t.prototype.calcItemSize=function(t,e){return e<=0?this.item_size:.75*this.item_size+this.item_size*t.total/e*.25},t.prototype.drawButton=function(){var t=this
this.buttons.selectAll(".button").remove()
var e=this.buttons.append("g").attr("class","button button-back").style("opacity",0).on("click",function(){t.in_transition||(t.in_transition=!0,"year"===t.overview?t.removeYearOverview():"month"===t.overview?t.removeMonthOverview():"week"===t.overview?t.removeWeekOverview():"day"===t.overview&&t.removeDayOverview(),t.history.pop(),t.overview=t.history.pop(),t.drawChart())})
e.append("circle").attr("cx",this.label_padding/2.25).attr("cy",this.label_padding/2.5).attr("r",this.item_size/2),e.append("text").attr("x",this.label_padding/2.25).attr("y",this.label_padding/2.5).attr("dy",function(){return Math.floor(t.width/100)/3}).attr("font-size",function(){return Math.floor(t.label_padding/3)+"px"}).html("&#x2190;"),e.transition().duration(this.transition_duration).ease("ease-in").style("opacity",1)},t.prototype.removeGlobalOverview=function(){this.items.selectAll(".item-block-year").transition().duration(this.transition_duration).ease("ease-out").style("opacity",0).remove(),this.labels.selectAll(".label-year").remove()},t.prototype.removeYearOverview=function(){this.items.selectAll(".item-circle").transition().duration(this.transition_duration).ease("ease").style("opacity",0).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-month").remove(),this.hideBackButton()},t.prototype.removeMonthOverview=function(){var t=this
this.items.selectAll(".item-block-month").selectAll(".item-block-rect").transition().duration(this.transition_duration).ease("ease-in").style("opacity",0).attr("x",function(e,n){return n%2==0?-t.width/3:t.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()},t.prototype.removeWeekOverview=function(){var t=this
this.items.selectAll(".item-block-week").selectAll(".item-block-rect").transition().duration(this.transition_duration).ease("ease-in").style("opacity",0).attr("x",function(e,n){return n%2==0?-t.width/3:t.width/3}).remove(),this.labels.selectAll(".label-day").remove(),this.labels.selectAll(".label-week").remove(),this.hideBackButton()},t.prototype.removeDayOverview=function(){var t=this
this.items.selectAll(".item-block").transition().duration(this.transition_duration).ease("ease-in").style("opacity",0).attr("x",function(e,n){return n%2==0?-t.width/3:t.width/3}).remove(),this.labels.selectAll(".label-time").remove(),this.labels.selectAll(".label-project").remove(),this.hideBackButton()},t.prototype.hideTooltip=function(){this.tooltip.transition().duration(this.transition_duration/2).ease("ease-in").style("opacity",0)},t.prototype.hideBackButton=function(){this.buttons.selectAll(".button").transition().duration(this.transition_duration).ease("ease").style("opacity",0).remove()},t.prototype.formatTime=function(t){var e=parseInt(t,10),n=Math.floor(e/3600),i=Math.floor((e-3600*n)/60),a=""
return n>0&&(a+=1===n?"1 hour ":n+" hours "),i>0&&(a+=1===i?"1 minute":i+" minutes"),0===n&&0===i&&(a=t+" seconds"),a},t}()
__decorate([core_1.ViewChild("root"),__metadata("design:type",Object)],CalendarHeatmap.prototype,"element",void 0),__decorate([core_1.Input(),__metadata("design:type",Array)],CalendarHeatmap.prototype,"data",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CalendarHeatmap.prototype,"color",void 0),__decorate([core_1.Input(),__metadata("design:type",String)],CalendarHeatmap.prototype,"overview",void 0),__decorate([core_1.Output(),__metadata("design:type",core_1.EventEmitter)],CalendarHeatmap.prototype,"handler",void 0),__decorate([core_1.HostListener("window:resize",["$event"]),__metadata("design:type",Function),__metadata("design:paramtypes",[Object]),__metadata("design:returntype",void 0)],CalendarHeatmap.prototype,"onResize",null),CalendarHeatmap=__decorate([core_1.Component({selector:"calendar-heatmap",template:"<div #root></div>",styles:["\n    :host {\n      user-select: none;\n      -ms-user-select: none;\n      -moz-user-select: none;\n      -webkit-user-select: none;\n    }\n    :host >>> .item {\n      cursor: pointer;\n    }\n    :host >>> .label {\n      cursor: pointer;\n      fill: rgb(170, 170, 170);\n      font-family: Helvetica, arial, 'Open Sans', sans-serif;\n    }\n    :host >>> .button {\n      cursor: pointer;\n      fill: transparent;\n      stroke-width: 2;\n      stroke: rgb(170, 170, 170);\n    }\n    :host >>> .button text {\n      stroke-width: 1;\n      text-anchor: middle;\n      fill: rgb(170, 170, 170);\n    }\n    :host >>> .heatmap-tooltip {\n      pointer-events: none;\n      position: absolute;\n      z-index: 9999;\n      width: 250px;\n      max-width: 250px;\n      overflow: hidden;\n      padding: 15px;\n      font-size: 12px;\n      line-height: 14px;\n      color: rgb(51, 51, 51);\n      font-family: Helvetica, arial, 'Open Sans', sans-serif;\n      background: rgba(255, 255, 255, 0.75);\n    }\n    :host >>> .heatmap-tooltip .header strong {\n      display: inline-block;\n      width: 250px;\n    }\n    :host >>> .heatmap-tooltip span {\n      display: inline-block;\n      width: 50%;\n      padding-right: 10px;\n      box-sizing: border-box;\n    }\n    :host >>> .heatmap-tooltip span,\n    :host >>> .heatmap-tooltip .header strong {\n      white-space: nowrap;\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  "]})],CalendarHeatmap),exports.CalendarHeatmap=CalendarHeatmap
